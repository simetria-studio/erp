$(document).ready((function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),Object.is=function(obj){var r;return"object"==typeof obj},$(".phone1").mask("(41) 9999-9999"),$(".phone2").mask("(41) 99999-9999"),$('[name="zip_code"]').mask("00000-000"),$('[name="zip_code"]').on("keyup blur",(function(){9==$(this).val().length&&$.ajax({url:"/cep/"+$(this).val(),type:"GET",success:data=>{$('[name="address"]').val(data.logradouro),data.logradouro&&$('[name="address"]').prop("readonly",!0),$('[name="address2"]').val(data.bairro),data.bairro&&$('[name="address2"]').prop("readonly",!0),$('[name="state"]').val(data.uf),data.uf&&$('[name="state"]').prop("readonly",!0),$('[name="city"]').val(data.localidade),data.localidade&&$('[name="city"]').prop("readonly",!0),$('[name="number"]').focus()}})})),$(".date-mask").mask("99/99/9999"),$(".date-mask").daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD/MM/YYYY",daysOfWeek:["dom","seg","ter","qua","qui","sex","sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","outubro","Novembro","Dezembro"],applyLabel:"Aplicar",cancelLabel:"Cancelar"}});var Toast=Swal.mixin({toast:!0,position:"center",showConfirmButton:!1,timer:4e3});$(".select2").select2(),$(".table").DataTable({responsive:!1,autoWidth:!1,language:{url:"/plugin/datatables-language/pt-br.json"},order:!1}),$(document).on("change",".check-all",(function(){var column=$(this).data("column");$(this).is(":checked")?$(this).closest("table").find(column).each((function(){$(this).find('[type="checkbox"]').prop("checked",!0)})):$(this).closest("table").find(column).each((function(){$(this).find('[type="checkbox"]').prop("checked",!1)}))})),$(document).on("click",".btn-modal-salvar",(function(){let save_target=$(this).data("save_target"),save_route=$(this).data("save_route"),update_table=$(this).data("update_table"),table_tbody=$(this).data("tbody"),type=$(this).data("type");var form_data=$(save_target).serializeArray(),checkbox=$(save_target).find("input[type=checkbox]");$.each(checkbox,(function(key,val){form_data.push({name:$(this).attr("name"),value:$(this).is(":checked")})})),$(save_target).find("input").removeClass("is-invalid"),$(save_target).find(".invalid-feedback").remove();let modal=$(save_target);modal.find("input, select").attr("readonly",!0),modal.find("button").attr("disabled",!0),$.ajax({url:save_route,type:"PUT"==type?"PUT":"POST",data:form_data,enctype:"multipart/form-data",success:data=>{modal.find("input, select").attr("readonly",!1),modal.find("button").attr("disabled",!1),$(modal).parent().parent().parent().modal("hide"),$(save_target).find('input[type="text"]').val(""),"S"==update_table&&data.table&&$("table "+table_tbody).append(data.table),"S"==update_table&&data.tb_up&&$("table "+table_tbody).find(".tr-id-"+data.tb_id).html(data.tb_up),Toast.fire({icon:"success",title:"Os dados foram salvos com successo!"})},error:err=>{modal.find("input, select").attr("readonly",!1),modal.find("button").attr("disabled",!1);let erro_tags=err.responseJSON.errors;$.each(erro_tags,(key,value)=>{let tag=$(save_target).find('[name="'+key+'"]');tag.addClass("is-invalid"),tag.parent().append('<div class="invalid-feedback">'+value[0]+"</div>")}),err.responseJSON.msg_alert&&Swal.fire({icon:err.responseJSON.icon_alert,text:err.responseJSON.msg_alert})}})})),$(document).on("click",".btn-editar",(function(){var target=$(this).data("target"),dados=$(this).data("dados");Object.is(dados)||console.log(JSON.parse(dados)),$.each(dados,(key,value)=>{$(target).find('[name="'+key+'"').val(value),$(target).find("."+key).val(value),$(target).find("._"+key).text(value)}),$(target).find("input[type=checkbox]").each((function(){"true"==$(this).val()?$(this).prop("checked",!0):$(this).prop("checked",!1)}))})),$(document).on("click",".btn-apagar",(function(e){var dados=$(this).data("dados"),route=$(this).data("route"),table_tbody=$(this).data("tbody");Swal.fire({icon:"info",title:"Apagar Item",text:"Tem certeza que gostatia de apagar esse item?",showCancelButton:!0,confirmButtonText:"SIM",cancelButtonText:"NÃO",showLoaderOnConfirm:!0,preConfirm:destroy=>$.ajax({url:route,type:"DELETE",data:dados}).then(response=>(console.log(response),$("table "+table_tbody).find(".tr-id-"+response).remove(),Toast.fire({icon:"success",title:"Os dados foram salvos com successo!"}),response)).catch(error=>{Swal.showValidationMessage(error.responseJSON)})})})),$(document).on("change","#company_with",(function(){var dados=$(this).find("option:selected").data("dados");if(console.log(dados),dados.deposits){$('[name="deposit"]').empty();for(var i=0;dados.deposits.length>i;i++)$('[name="deposit"]').append('<option value="'+dados.deposits[i].id+'">'+dados.deposits[i].name+"</option>")}if(dados.client_suppliers){$('[name="client_supplier"]').empty();for(var i=0;dados.client_suppliers.length>i;i++)$('[name="client_supplier"]').append('<option value="'+dados.client_suppliers[i].id+"\" data-dados='"+JSON.stringify(dados.client_suppliers[i])+"'>"+dados.client_suppliers[i].id+" - "+dados.client_suppliers[i].corporate_name+"</option>")}if(dados.products_groups){$('[name="product_group"]').empty();for(var i=0;dados.products_groups.length>i;i++)$('[name="product_group"]').append('<option value="'+dados.products_groups[i].id+'">'+dados.products_groups[i].name+"</option>")}})),$(document).on("click",".btn-add-foto",(function(){$(this).parent().find(".add-foto").trigger("click")})),$(document).on("change",".add-foto",(function(){$(this).removeClass("add-foto"),$(this).parent().find(".btn-add-foto").removeClass("btn-primary btn-add-foto").addClass("btn-danger btn-remove-foto").html('<i class="ri-delete-bin-6-fill"></i> Remover Foto'),$(this).parent().parent().append('<div class="col-6 col-md-3 mb-2"><button type="button" class="btn btn-primary btn-add-foto mb-2"><i class="ri-add-fill"></i> Anexar Foto</button><input type="file" class="d-none add-foto" name="foto[]"><div class="foto"></div></div>');var form_img,preview=$(this).parent().find(".foto"),files=$(this).prop("files");function readAndPreview(file){if(/\.(jpe?g|png|gif)$/i.test(file.name)){var reader=new FileReader;reader.addEventListener("load",(function(){var image=new Image;image.classList="rounded img-fluid",image.title=file.name,image.src=this.result,preview.append(image)}),!1),reader.readAsDataURL(file)}}files&&[].forEach.call(files,readAndPreview)})),$(document).on("click",".btn-remove-foto",(function(){$(this).parent().remove()})),$(document).on("change","#type_person",(function(){switch($(".document-number, .D-J, .D-F, .tax-regime-code, .ie-exempt, .municipal-registration, .R-G, .issuing-agency").addClass("d-none"),$(this).val()){case"J":$(".document-number").removeClass("d-none").find(".D-J").removeClass("d-none"),$(".tax-regime-code").removeClass("d-none"),$(".ie-exempt").removeClass("d-none"),$(".municipal-registration").removeClass("d-none"),$("#taxpayer").val("1");break;case"F":$(".document-number").removeClass("d-none").find(".D-F").removeClass("d-none"),$(".R-G").removeClass("d-none"),$(".issuing-agency").removeClass("d-none"),$("#taxpayer").val("9")}})),$(document).on("change","#taxpayer",(function(){switch($(".state-registration input").prop("disabled",!1),$(".ie-exempt input").prop("checked",!1),$(this).val()){case"2":$(".state-registration input").prop("disabled",!0),$(".ie-exempt input").prop("checked",!0)}})),$(document).on("change","#ie_exempt_check",(function(){$(".state-registration input").prop("disabled",!1),$(this).is(":checked")&&$(".state-registration input").prop("disabled",!0)})),$(document).on("click",".btn-add-variacao",(function(){var total_variacoes=$(".variacoes").find("variacao-filho").length,q_varaicoes=parseInt($(".q-variacoes").val())||0,q_atributos=parseInt($(".q-atributos").val())||0;$(".q-variacoes,.q-atributos").val("");for(var Vi=1;q_varaicoes>=Vi;Vi++){var html='<div class="row variacao-filho">';html+='<div class="col-12 mt-4 mb-2"><h1>'+(total_variacoes+Vi)+"ª Variação</h1></div>",html+='<div class="col-12 col-md-9"><label>Atributos (Exemplos = Cor:verde - Peso:5kg)</label><div class="input-group">';for(var Ai=0;q_atributos>Ai;Ai++)html+='<input type="text" class="form-control" name="variacoes['+(total_variacoes+Vi)+'][atributo][]">';html+="</div></div>",html+='<div class="col-12 col-md-3"><label>Preço</label><input type="text" class="form-control" name="variacoes['+(total_variacoes+Vi)+'][price]"></div>',html+="</div>",$(".variacoes").append(html)}})),$(document).on("change","#product_type",(function(){"P"==$(this).val()&&($(".caracteristicas").removeClass("d-none"),$("#estoque-tab-justify").parent().removeClass("d-none")),"S"==$(this).val()&&($(".caracteristicas").addClass("d-none"),$("#estoque-tab-justify").parent().addClass("d-none"))})),$(document).on("change","#sales_format",(function(){"S"==$(this).val()&&($(".caracteristicas").removeClass("d-none"),$("#variacoes-tab-justify").parent().addClass("d-none")),"CV"==$(this).val()&&($(".caracteristicas").addClass("d-none"),$("#variacoes-tab-justify").parent().removeClass("d-none"))})),$(document).on("click",".btn-add-fornecedor",(function(){var opt=$("#client_supplier option:selected");opt.remove();var dados=opt.data("dados");$(".fornecedores").append('<div class="row"><div class="col-12 col-md-6"><label for="providers">Codigo e Nome do Fornecedor</label><input type="text" class="form-control" value="'+dados.id+"-"+dados.corporate_name+'" disabled><input type="hidden" name="providers['+dados.id+'][provider_id]" value="'+dados.id+'"><input type="hidden" name="providers['+dados.id+'][provider_name]" value="'+dados.corporate_name+'"></div><div class="col-12 col-md-4"><label for="providers">preço de Custo</label><input type="text" name="providers['+dados.id+'][cost_price]" class="form-control"></div><div class="col-12 col-md-2"><button type="button" class="btn btn-danger btn-remove-provider mt-4" data-dados=\''+JSON.stringify(dados)+'\'><i class="ri-close-fill"></i></button></div></div>')})),$(document).on("click",".btn-remove-provider",(function(){var dados=$(this).data("dados");$(this).closest(".row").remove(),$("#client_supplier").append('<option value="'+dados.id+"\" data-dados='"+JSON.stringify(dados)+"'>"+dados.id+" - "+dados.corporate_name+"</option>")})),$(document).on("click",".btn-add-contact",(function(){var position=(parseInt($(".position").val())||0)+1;$(".position").val(position),$(".contatos").append('<div class="row"><div class="form-group col-12 col-md-4"><label for="contact">Nome do Contato</label><input type="text" name="contact['+position+'][contact_name]" class="form-control" placeholder="Nome do Contato"></div><div class="form-group col-12 col-md-4"><label for="contact">Telefone</label><input type="text" name="contact['+position+'][phone1]" class="form-control phone1" placeholder="Telefone"></div><div class="form-group col-12 col-md-4"><label for="contact">Celular</label><input type="text" name="contact['+position+'][phone2]" class="form-control phone2" placeholder="Celular"></div><div class="form-group col-12 col-md-4"><label for="contact">E-Mail</label><input type="text" name="contact['+position+'][contact_email]" class="form-control" placeholder="E-Mail"></div></div>'),$(".phone1").mask("(41) 9999-9999"),$(".phone2").mask("(41) 99999-9999")}))}));